CREATE DATABASE locadora_db;
CREATE USER locadora WITH PASSWORD '32421451';
GRANT ALL PRIVILEGES ON DATABASE locadora_db TO locadora;


CREATE TABLE LIVRO(
    ETIQUETA INTEGER NOT NULL,
    TITULO VARCHAR(50) NOT NULL,
    CATEGORIA VARCHAR(50) NOT NULL,
    ANO_LANCAMENTO INTEGER NOT NULL,
    QUANTIDADE_COPIA INTEGER NOT NULL,
    CONSTRAINT LIVRO_PK PRIMARY KEY (ETIQUETA)
);
 
CREATE TABLE ALUGA(
    ETIQUETA_LIVRO INTEGER NOT NULL,        
    EMAIL_CLIENTE VARCHAR(50) NOT NULL,         
    DATA_SAIDA DATE NOT NULL,
    DATA_DEVOLUCAO DATE NOT NULL,
    CONSTRAINT ALUGA_PK PRIMARY KEY (ETIQUETA_LIVRO, EMAIL_CLIENTE, DATA_SAIDA)
);

CREATE TABLE CLIENTE(
    EMAIL VARCHAR(50) NOT NULL, 
    NOME VARCHAR(50) NOT NULL,
    TELEFONE VARCHAR(15) NOT NULL,
    ENDERECO VARCHAR(100) NOT NULL,
    NUMERO_CARTAO INTEGER,
    CONSTRAINT CLIENTE_PK PRIMARY KEY (EMAIL)
);



CREATE TABLE AUTOR(
    CPF VARCHAR(11) NOT NULL,
    NOME VARCHAR(50) NOT NULL,
    CIDADE VARCHAR(30) NOT NULL,
    DATA_NASCIMENTO DATE NOT NULL,
    QUANTIDADE_LIVRO NUMERIC(4) NOT NULL
);
ALTER TABLE AUTOR ADD CONSTRAINT AUTOR_PK PRIMARY KEY (CPF);

CREATE TABLE ESCREVE(
    CPF_AUTOR VARCHAR(11) NOT NULL,             //CHAVE ESTRANGEIRA
    ETIQUETA_LIVRO NUMERIC(10) NOT NULL         //CHAVE ESTRANGEIRA
);

ALTER TABLE ESCREVE ADD CONSTRAINT ESCREVE_PK PRIMARY KEY (CPF_AUTOR, ETIQUETA_LIVRO);
ALTER TABLE ESCREVE ADD CONSTRAINT ESCREVE_FK_AUTOR FOREIGN KEY (CPF_AUTOR) REFERENCES AUTOR (CPF);
ALTER TABLE ESCREVE ADD CONSTRAINT ESCREVE_FK_LIVRO FOREIGN KEY (ETIQUETA_LIVRO) REFERENCES LIVRO (ETIQUETA);






ALTER TABLE ALUGA ADD CONSTRAINT ALUGA_FK_LIVRO FOREIGN KEY (ETIQUETA_LIVRO) REFERENCES LIVRO (ETIQUETA);
ALTER TABLE ALUGA ADD CONSTRAINT ALUGA_FK_CLIENTE FOREIGN KEY (EMAIL_CLIENTE) REFERENCES CLIENTE (EMAIL);




CREATE TABLE CARTAO(
    NUMERO NUMERIC(15) NOT NULL,
    STATUS VARCHAR(30) NOT NULL,
    CREDITO DECIMAL(10,2) NOT NULL,
    EMAIL_CLIENTE VARCHAR(60) NOT NULL          //CHAVE ESTRANGEIRA
);
ALTER TABLE CARTAO ADD CONSTRAINT CARTA_PK PRIMARY KEY (NUMERO);
ALTER TABLE CARTAO ADD CONSTRAINT CARTAO_FK_CLIENTE FOREIGN KEY (EMAIL_CLIENTE) REFERENCES CLIENTE (EMAIL);